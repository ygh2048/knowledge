# ARM简介

基于RISC的精简指令集处理器架构


## 内存管理和调度

ARM 支持虚拟内存，意味着处理器地址不直接对应物理内存地址    

## MMU 内存管理单元

MMU使用页表来维护虚拟地址到物理地址的映射关系，当处理器访问一个虚拟地址的时候，MMU会查找页表来找到相应的物理地址

支持页表级联        
# 计算机架构

系统总线包含有三种  
- 数据总线 DB
  - 通常与处理器字长一直
- 地址总线 AB
  - 位数决定可寻址空间大小
- 控制总线 CB
  - 传送控制信号和时序信号



## cache 高数缓冲存储器
CPU可以直接访问，用来存放暂时不参与运行的程序和数据，需要时再传送到主存。   

## 运算器

ALU（算术逻辑运算单元），和若干寄存器，如：暂存器，累加寄存器。   

## 控制器
由于：  
- 程序计数器PC  
- 指令寄存器IR
- 指令译码器ID
- 操作控制器OC


根据用户预先编好的程序，依次从存储器中取出各条指令，放在指令寄存器IR中，通过译码分析，确定进行什么操作，然后通过操作控制器OC,按照确定的时序向相应的部件发出控制信号
 


## 寄存器

### 寄存器组
- 31个通用寄存器，包括PC（程序计数器），都是32位寄存器   //ARM 64位
- 6个状态寄存器，也是32位寄存器

### 处理器模式
7种处理器模式   
- 用户模式
- 快速中断模式
- 普通中断模式
- 管理模式-SVC
- 数据访问中止模式
- 未定义指令中止模式
- 系统模式-SYS


//ARM 32位
任意一种处理器模式中有一组相应的寄存器，在任意一种处理器模式下，可见的寄存器包括15个通用寄存器（R0 ~ R14）,一个或两个状态寄存器/程序计数器PC（R15）  

有些模式是共用同一个物理寄存器，有些寄存器是各个模式自己独立的物理寄存器。    


### R0 - R15寄存器
- R0~R3 用作传入函数参数，传出函数返回值   但函数传入值多余四个时，其余参数会压入栈中来传递
- R4~R11 被用来存放函数的局部变量
- R12 是内部调用暂时寄存器ip。
- R13 是栈指针SP
- R14 是链接寄存器LR,如果保存了返回地址，则可以调动之间将R14用于其他用途，程序返回时要恢复
- R15 是程序计数器PC 不能用于任何其他用途

在中断程序中，所有寄存器中，所有寄存器都必须保护，编译器会自动保护R4~R11    



### 介绍
## 总结

使用LORD/STORE指令    



1. 取指
2. 译码
3. 执行
4. 修改指令计数器




# 系统编程

## 启动代码 bootloader

bootloader是运行在处理器上的第一段软件，它的主要任务是初始化硬件设备。建立内存空间的映射，为加载操作系统或其他应用程序准备必要的环境。

bootloader需要完成内存管理单元MMU的初始化，设置好内存的虚拟地址到物理地址。     


# 两种控制器介绍


## Cortex-M
- 无MMU的控制器，所以无法运行完整linux
  - 通过MPU可以实现内存保护的功能，但不能地址映射 
- 32位架构
  

## Cortex-A

- 有MMU的控制器，所以可以运行完整OS   
  - 启动时需要初始化MMU
- 仅仅Cortex-A使用ARMv8
  - 32位或者64位架构
